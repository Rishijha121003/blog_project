{% extends 'blog/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ post.title }} | MyBlog{% endblock %}

{% block content %}
<div class="container post-detail-page-container">

  <article class="post-detail">

    <div class="post-detail-left">
      {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-image">
      {% endif %}

      <p class="meta">
        By {{ post.author }} ‚Ä¢ {{ post.created_at|date:"M d, Y" }}
      </p>
    </div>

    <div class="post-detail-right">
      <h1>{{ post.title }}</h1>

      <div class="post-content">
        {{ post.content|safe }}
      </div>

      <div class="post-actions">
        <a href="{% url 'show_blog' %}">‚Üê Back to posts</a>
        <a href="{% url 'home' %}">‚Üê Back to home</a>
      </div>

      <div class="like-section">
        {% if user.is_authenticated %}
        <form action="{% url 'like_post' post.pk %}" method="POST" style="display: inline-block;">
          {% csrf_token %}
          {% if user in post.likes.all %}
          <button type="submit" class="btn btn-danger">Unlike</button>
          {% else %}
          <button type="submit" class="btn btn-primary">Like</button>
          {% endif %}
        </form>
        <span>{{ post.total_likes }} Likes ‚ù§Ô∏è</span>
        {% else %}
        <p><a href="{% url 'login' %}">Login</a> to like this post.</p>
        {% endif %}
      </div>

      <hr style="margin: 2rem 0;">

      <div class="comments-section">
        <h4>üí¨ Comments ({{ comments.count }})</h4>

        <ul class="comments-list">
          {% for comment in comments %}
          <li class="comment-item">
            <div>
              <strong>{{ comment.user.username }}</strong> ‚Äî {{ comment.content }}
            </div>
            <small class="text-muted">{{ comment.created_at|naturaltime }}</small>
          </li>
          {% empty %}
          <li class="comment-item">No comments yet. Be the first to comment!</li>
          {% endfor %}
        </ul>

        {% if user.is_authenticated %}
        <form method="post" class="comment-form">
          {% csrf_token %}
          {{ form.content }}
          <button type="submit" class="btn btn-success">Add Comment</button>
        </form>
        {% else %}
        <p><a href="{% url 'login' %}">Login</a> to comment.</p>
        {% endif %}
      </div>

    </div>
  </article>
</div>
{% endblock %}